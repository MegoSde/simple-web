@using System.Globalization
@functions{
    static string CropAttr(double[] arr) =>
        string.Join(",", arr.Select(v => v.ToString("G17", CultureInfo.InvariantCulture)));
}
@model cms.Models.CropEditorVm
@{
    ViewData["Title"] = $"Crop: {Model.Hash}";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<a class="backlink" href="@Url.Action("List","Media")">
    <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
        <use href="/icons.v1.svg#i-back"></use>
    </svg>
    Tilbage
</a>
<h1>Crop for @Model.Hash</h1>

<div id="cropEditorRoot"
     data-hash="@Model.Hash"
     data-a="@Model.A"
     data-b="@Model.B">
</div>

<div id="presetGroupBar" class="mb-2">
  @foreach (var g in Model.Groups)
  {
      <button type="button"
              class="btn btn-sm btn-outline-secondary ratio-pill"
              data-ratio="@g.RatioKey">
          @g.RatioKey (@g.Count)
      </button>
  }
</div>

<div>
@foreach (var p in Model.Presets)
{
    var crop = p.Existing is not null ? CropAttr(p.Existing) : "";
    <button type="button"
            class="btn btn-sm btn-outline-primary preset-pill"
            data-p="@p.Name"
            data-w="@p.Width"
            data-h="@p.Height"
            data-ratio="@p.RatioKey"
            data-crop="@crop">
        @p.Name (@p.Width x @p.Height)
    </button>
}
</div>

<div class="my-3">
  <strong>Aktivt preset:</strong> <span id="activePreset"></span>
  <button id="saveBtn" class="btn btn-primary btn-sm ms-2" disabled>Gem</button>
  <button id="saveGroupBtn" class="btn btn-secondary btn-sm ms-2" disabled>Gem valgt gruppe</button>
  <span id="savedMsg" class="text-success ms-2" style="display:none;">Gemt âœ“</span>
</div>

<div class="crop-wrap" id="wrap">
  <img src="@Model.WorkSrc" id="img" class="crop-img" />
  <div id="rect" class="crop-rect" style="display:none;">
    <div class="handle"></div>
  </div>
</div>

<form id="saveForm" method="post" style="display:none;" action="">
  @Html.AntiForgeryToken()
  <input name="x" id="fx" />
  <input name="y" id="fy" />
  <input name="w" id="fw" />
  <input name="h" id="fh" />
</form>

@section Scripts {
    <script src="~/preset-editor.js" defer></script>
}